from __future__ import annotations

import subprocess
from pathlib import Path


def _run_node(script: Path) -> None:
    result = subprocess.run(
        ["node", str(script)], capture_output=True, text=True, check=False
    )
    assert result.returncode == 0, (
        f"Node script {script} failed with code {result.returncode}:\n"
        f"STDOUT:\n{result.stdout}\nSTDERR:\n{result.stderr}"
    )


def test_orientation_persistence_fixture() -> None:
    script = Path("tests/js/test_orientation_persistence.mjs")
    assert script.exists()
    _run_node(script)


def test_fpv_movement_idle_velocity_zero() -> None:
    script = Path("tests/js/test_fpv_movement_idle.mjs")
    assert script.exists()
    _run_node(script)


def test_wall_drag_snap_pipeline() -> None:
    script = Path("tests/js/test_wall_drag_snap.mjs")
    assert script.exists()
    _run_node(script)
